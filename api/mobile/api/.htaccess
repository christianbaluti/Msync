# --- 1. SET ALL CORS HEADERS ---
# This allows your app to make requests to the API
<IfModule mod_headers.c>
  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
  Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization"
</IfModule>

# --- 2. HANDLE PREFLIGHT (OPTIONS) REQUESTS ---
# This intercepts the OPTIONS request and sends a "200 OK"
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{REQUEST_METHOD} OPTIONS
  RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# --- 3. FIX THE MISSING AUTHORIZATION HEADER (THE REAL PROBLEM) ---
# This section passes the header to PHP so $_SERVER['HTTP_AUTHORIZATION'] works.

# Method 1: Standard Apache rewrite
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{HTTP:Authorization} .
  RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</IfModule>

# Method 2: Alternative for FastCGI/PHP-FPM (very common on cPanel)
<IfModule mod_setenvif.c>
  SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
</IfModule>